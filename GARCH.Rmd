---
title: "GARCH"
author: "Diego Pintor"
date: "23/3/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(quantmod)
library(PerformanceAnalytics)
library(fBasics)
library(akima)
library(normtest)
library(crop)
library(lubridate)
library(tibble)
library(ggplot2)
library(fTrading)
library(fGarch)
```
# Actividad Modelos ARCH/GARCH
# 1. Bajando los datos y obteniendo el rendimiento
```{r, warning=FALSE}
clave <- "SITESB-1.MX"
datos <- new.env()
getSymbols(clave, from = "2016-01-02", to = today(), warnings = FALSE, env = datos)
precio <- datos[[clave]][,6] #la información en la columna 6, o sea los precios al cierre
names(precio) <- clave
Rendimiento<-na.omit(diff(log(precio)))
```
# 2.Probando independencia de los precios

```{r}
independencia <- Box.test(precio,lag=1,type="Ljung-Box",fitdf = 0)
independencia$statistic
```


Como el estadístico de la prueba de Box es mayor que 23.20925, valor del estadístico (1156.18), se rechaza la H0 y se acepta la Hipótesis Alternativa, los precios son dependientes.

# 3. Haciendo uso de la función garchFit para estimar los parámetros del modelo.

```{r, include=FALSE}
garch11 <- garchFit(formula = ~garch(1,1),data = Rendimiento, cond.dist = "norm")
garch12 <- garchFit(formula = ~garch(1,2),data = Rendimiento, cond.dist = "norm")
garch21 <- garchFit(formula = ~garch(2,1),data = Rendimiento, cond.dist = "norm")
garch22 <- garchFit(formula = ~garch(2,2),data = Rendimiento, cond.dist = "norm")
garch10 <- garchFit(formula = ~garch(1,0),data = Rendimiento, cond.dist = "norm")
garch20 <- garchFit(formula = ~garch(2,0),data = Rendimiento, cond.dist = "norm")
```

Extrayendo los parámetros de los modelos Garch creados

```{r}
parGarch11 <- garch11@fit[["par"]]
parGarch12 <- garch12@fit[["par"]]
parGarch21 <- garch21@fit[["par"]]
parGarch22 <- garch22@fit[["par"]]
parGarch10 <- garch10@fit[["par"]]
parGarch20 <- garch20@fit[["par"]]
```


Extrayendo Estadísticos de Criterio para encontrar el modelo óptimo que se ajuste a SITESB-1.mx



```{r}
icsGarch11 <- garch11@fit[["ics"]]
icsGarch12 <- garch12@fit[["ics"]]
icsGarch21 <- garch21@fit[["ics"]]
icsGarch22 <- garch22@fit[["ics"]]
icsGarch10 <- garch10@fit[["ics"]]
icsGarch20 <- garch20@fit[["ics"]]
```


```{r}
AICoptimo <- c(icsGarch20[1],icsGarch10[1],icsGarch11[1],icsGarch12[1],icsGarch21[1],icsGarch22[1])
AICoptimo <- sort(AICoptimo)
AICoptimo
icsGarch11
```


El modelo óptimo para los datos es el modelo Garch 1,1 

```{r}
#parGarch11
# Obteniendo volatilidad a largo plazo
VL = as.numeric(parGarch11[2])/as.numeric(1-parGarch11[3]-parGarch11[4])
VL
```
La volatilidad a largo plazo es 0.0003586

Suma de funciones de verosimilitud
```{r}
vLGarch11 <- garch11@fit[["value"]][["LogLikelihood"]]
vLGarch12 <- garch12@fit[["value"]][["LogLikelihood"]]
vLGarch21 <- garch21@fit[["value"]][["LogLikelihood"]]
vLGarch22 <- garch22@fit[["value"]][["LogLikelihood"]]
vLGarch10 <- garch10@fit[["value"]][["LogLikelihood"]]
vLGarch20 <- garch20@fit[["value"]][["LogLikelihood"]]
```


# 4. Comparando las estimaciones del modelo contra las estimaciones reales.

```{r}
Rendimiento2 <- Rendimiento**2
Var_Real<-Rendimiento**2
Vol_Real<-sqrt(Var_Real)
n <- nrow(Var_Real)

Var_Est <- matrix(0,n-1,1) # Variable en la que estimar volatilidad

a <- seq(0.1,0.99,by=0.01)
Var_Est[1,1] <- Var_Real[1,1] #Mismo valor inicial

Func <- matrix(0,n-1,1)

Resultados <- matrix(0,length(a),3) #Matriz de resultados

colnames(Resultados) <- c('Omega', 'Alpha',"Beta")
j <- 0

for (L in a) {
for (i in 2:(n-1)) {
Var_Est[i,1] <- parGarch11[2]+ parGarch11[3]*Var_Real[i-1,1] + parGarch11[4]*Var_Est[i-1,1] #modelo GARCH
}
j <- j+1
FMaxAct <- sum(Func)
Resultados[j,1] <- L
Resultados[j,2] <- FMaxAct
}

#L_opt <- Resultados[order(Resultados[,'Sum_FMV'], decreasing = TRUE),]
#L_opt <- as.numeric(L_opt[1,1])
#Var_Est_EWMA <- xts(emaTA(Var_Real, lambda = L_opt), order.by= date(Rendimiento))
#Resultados2 <- merge.xts(Var_Real, Var_Est)
#names(Resultados2) <- c('Var_Real','Var_GARCH1,1')
#plot(Resultados2, legend.loc = 'top', lwd=c(.4,.8), col=c('blue','red'))
length(Var_Real)
length(Var_Est)
```
Se puede concluir que (blablablabla)


# 5. Efectuar estimación futura de la volatilidad.

```{r}

```

